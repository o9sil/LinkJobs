<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.linkJobs.mapper.CpMemberMapper">

	<!-- 기업회원 PW 수정 -->
	<update id="updateCpMemberPw" parameterType="com.gdu.linkJobs.vo.AlterCpMemberPw">
		UPDATE linkjobs_cpmember 
		SET cpmember_pw = PASSWORD(#{cpMemberPwAfter}) 
		WHERE cpmember_id = #{cpMemberId} 
			AND cpmember_pw = PASSWORD(#{cpMemberPwBefore})
	</update>

	<!-- 기업회원 PW 찾기(DB는 수정) -->
	<update id="updateCpMemberPwRandom" parameterType="com.gdu.linkJobs.vo.CpMember">
	
	</update>

	<!-- 기업회원 ID 찾기 -->
	<select id="selectCpMemberId" parameterType="com.gdu.linkJobs.vo.CpMember" resultType="com.gdu.linkJobs.vo.CpMember">
		SELECT cpmember_id AS cpMemberId, cpmember_email AS cpMemberEmail 
		FROM linkjobs_cpmember 
		WHERE cpmember_license_no = #{cpMemberLicenseNo}
			AND cpmember_manager = #{cpMemberManager} 
			AND cpmember_email = #{cpMemberEmail}
	</select>

	<!-- 로그인 쿼리 -->
	<select id="selectLoginCpMember" parameterType="com.gdu.linkJobs.vo.LoginCpMember" resultType="String">
		SELECT
			cpmember_id			
		FROM linkjobs_cpmember
		WHERE cpmember_id = #{cpMemberId}
			AND cpmember_pw = PASSWORD(#{cpMemberPw})
			AND	cpmember_admin_admission = 'Y'
	</select>
	
	<!-- 회원가입 쿼리 -->
	<insert id="insertCpMember" parameterType="com.gdu.linkJobs.vo.CpMember">
		INSERT INTO linkjobs_cpmember(
			cpmember_id,
			cpmember_pw,
			cpmember_license_no,
			cpmember_manager,
			cpmember_company,
			cpmember_ceo,
			cpmember_phonenum,
			cpmember_date,
			cpmember_admin_admission
		) VALUES (
			#{cpMemberId},
			PASSWORD(#{cpMemberPw}),
			#{cpMemberLicenseNo},
			#{cpMemberManager},
			#{cpMemberCompany},
			#{cpMemberCeo},
			#{cpMemberPhoneNum},
			NOW(),
			'N'
		)
	</insert>
	
	<!-- 아이디 중복검사 쿼리 -->
	<select id="selectCpMemberIdCnt" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM (SELECT cpmember_id AS id FROM linkJobs_cpmember
      		  UNION
      		  SELECT cpmember_id AS id FROM linkJobs_cpmember_withdrawal) t
		WHERE t.id = #{cpmemberId}
	</select>
</mapper>